# P2P文件分享系统使用指南

## 功能概述

本P2P文件分享系统已完成以下核心功能的实现：

### 1. 文件分享功能
- 支持多文件选择和批量分享
- 自动计算文件哈希值
- 文件自动分块（64KB每块）
- 文件元数据发布到DHT网络
- 本地数据库存储文件信息

### 2. 文件下载功能
- 支持通过文件哈希值下载
- 自动发现文件提供者
- 分块下载机制
- 断点续传支持（通过ChunkManager）
- 下载进度显示
- 文件完整性验证

### 3. 文件搜索功能
- 本地文件搜索
- DHT网络搜索
- 关键词匹配

## 使用步骤

### 启动应用
1. 启动应用后，P2P节点会自动启动
2. 等待节点状态显示"在线"
3. 查看节点信息中的Peer ID

### 分享文件
1. 点击"选择文件"按钮
2. 选择要分享的文件（支持多选）
3. 确认选择的文件列表
4. 点击"分享选中文件"按钮
5. 等待文件处理和发布完成
6. 分享成功后，文件会出现在"本地文件"列表中

### 下载文件
1. 在搜索框输入文件名关键词
2. 点击"搜索"按钮
3. 在搜索结果中找到目标文件
4. 点击文件旁边的"下载"按钮
5. 在"活跃下载"区域查看下载进度
6. 下载完成后，文件保存在 `./downloads` 目录

### 连接其他节点
1. 获取其他节点的完整地址（包含IP、端口和Peer ID）
2. 将地址粘贴到"连接到节点"输入框
3. 点击"连接"按钮
4. 成功连接后，可以在"发现的节点"列表中看到

## 技术实现细节

### 文件分享流程
1. **文件处理**
   - 计算文件SHA256哈希值
   - 将文件分割成64KB的块
   - 计算每个块的哈希值

2. **元数据发布**
   - 创建文件元数据（名称、大小、哈希、块数等）
   - 将元数据发布到DHT网络
   - 宣告自己为文件提供者

3. **本地存储**
   - 文件信息存储到本地数据库
   - 文件块缓存在内存中

### 文件下载流程
1. **发现阶段**
   - 通过DHT查找文件元数据
   - 发现文件提供者列表

2. **下载阶段**
   - 建立与提供者的P2P连接
   - 按块请求文件数据
   - 验证每个块的完整性

3. **组装阶段**
   - 将所有块按顺序组装
   - 保存完整文件到下载目录

### 分块下载机制
- 支持并行下载多个块（最多5个并发）
- 失败重试机制（最多3次）
- 断点续传支持
- 实时进度更新

## 注意事项

1. **网络要求**
   - 确保防火墙允许应用的网络连接
   - 本地网络节点可以直接连接
   - 跨网络需要配置端口转发

2. **文件大小**
   - 大文件会自动分块处理
   - 分块下载可能需要较长时间
   - 建议先测试小文件

3. **节点发现**
   - 自动发现本地网络节点（通过mDNS）
   - 手动连接需要完整的节点地址
   - 引导节点仅用于网络发现，不能直接连接

4. **数据持久化**
   - 文件信息保存在本地数据库
   - 应用关闭时自动保存数据
   - 支持数据导入/导出功能

## 故障排除

### 无法分享文件
- 检查P2P节点是否已启动
- 确认文件路径有效
- 查看控制台错误信息

### 下载失败
- 确认有其他节点在线并提供该文件
- 检查网络连接
- 尝试重新连接提供者节点

### 连接问题
- 验证节点地址格式正确
- 确保目标节点在线
- 检查防火墙设置

## 性能优化建议

1. **批量操作**
   - 一次性选择多个文件分享
   - 避免频繁的单文件操作

2. **网络优化**
   - 保持与多个节点的连接
   - 定期刷新节点列表

3. **存储管理**
   - 定期清理数据库
   - 管理下载目录空间